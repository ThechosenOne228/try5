<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Share My Fit</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX/TypeScript -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.17.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.3/dist/coco-ssd.min.js"></script>
    <!-- MoveNet for pose detection -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection@2.0.0/dist/pose-detection.min.js"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #000;
        }
        #video-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1;
        }
        #video-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: opacity 0.5s ease;
        }
        #video-feed.fade-out {
            opacity: 0;
        }
        #app-root {
            position: relative;
            z-index: 2;
        }
        #error-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 8px;
            z-index: 1000;
            max-width: 80%;
            text-align: center;
        }
        #debug-info {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            z-index: 1000;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .camera-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 12px;
            backdrop-filter: blur(5px);
        }
        .camera-button {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.5rem;
        }
        .camera-button:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            transform: scale(1.05);
        }
        .camera-button:active {
            transform: scale(0.95);
        }
        .camera-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            border-color: rgba(255, 255, 255, 0.1);
        }
        .camera-button.active {
            background: rgba(255, 255, 255, 0.3);
            border-color: white;
        }
        .detection-label {
            position: absolute;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            border: 2px solid #fff;
            max-width: 300px;
        }
        .detection-label:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: scale(1.05);
        }
        .brand-logo {
            width: 24px;
            height: 24px;
            object-fit: contain;
        }
        .price-tag {
            background: #4CAF50;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
            margin-left: 4px;
        }
        .camera-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #000;
            z-index: 999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }
        .camera-transition.active {
            opacity: 1;
        }
        .pose-point {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #00ff00;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        .pose-line {
            position: absolute;
            background: #00ff00;
            height: 2px;
            transform-origin: 0 0;
        }
    </style>
</head>
<body>
    <div id="video-container">
        <video id="video-feed" autoplay playsinline></video>
    </div>
    <div id="app-root"></div>
    <div id="error-message" style="display: none;"></div>
    <div id="debug-info"></div>
    <div id="camera-transition" class="camera-transition"></div>

    <!-- App Scripts -->
    <script type="text/babel">
        // Product database with prices and descriptions
        const productDatabase = {
            'nike hoodie': {
                price: 69.99,
                description: 'Red hoodie with brushed fleece interior',
                category: 'tops'
            },
            'nike shoes': {
                price: 129.99,
                description: 'White Air Force 1s with clean design',
                category: 'shoes'
            },
            'adidas pants': {
                price: 59.99,
                description: 'Black track pants with three stripes',
                category: 'bottoms'
            },
            'ray-ban sunglasses': {
                price: 154.00,
                description: 'Classic Wayfarer style',
                category: 'accessories'
            },
            'levi\'s jeans': {
                price: 79.99,
                description: 'Classic 501 straight fit',
                category: 'bottoms'
            }
        };

        // Pose keypoints mapping
        const poseKeypoints = {
            nose: 0,
            leftEye: 1,
            rightEye: 2,
            leftShoulder: 5,
            rightShoulder: 6,
            leftElbow: 7,
            rightElbow: 8,
            leftWrist: 9,
            rightWrist: 10,
            leftHip: 11,
            rightHip: 12,
            leftKnee: 13,
            rightKnee: 14,
            leftAnkle: 15,
            rightAnkle: 16
        };

        // Brand logos mapping
        const brandLogos = {
            // Sportswear
            'nike': 'https://upload.wikimedia.org/wikipedia/commons/a/a6/Logo_NIKE.svg',
            'adidas': 'https://upload.wikimedia.org/wikipedia/commons/2/20/Adidas_Logo.svg',
            'puma': 'https://upload.wikimedia.org/wikipedia/commons/4/44/Puma_logo.svg',
            'reebok': 'https://upload.wikimedia.org/wikipedia/commons/3/31/Reebok_2019_logo.svg',
            'under armour': 'https://upload.wikimedia.org/wikipedia/commons/7/7c/Under_Armour_logo.svg',
            'new balance': 'https://upload.wikimedia.org/wikipedia/commons/1/1d/New_Balance_logo.svg',
            'converse': 'https://upload.wikimedia.org/wikipedia/commons/3/3b/Converse_logo.svg',
            'vans': 'https://upload.wikimedia.org/wikipedia/commons/3/36/Vans-logo.svg',
            'jordan': 'https://upload.wikimedia.org/wikipedia/commons/a/a6/Logo_NIKE.svg',
            'asics': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Asics_logo.svg',
            'fila': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Fila_logo.svg',
            'mizuno': 'https://upload.wikimedia.org/wikipedia/commons/9/9c/Mizuno_logo.svg',
            'brooks': 'https://upload.wikimedia.org/wikipedia/commons/8/8a/Brooks_logo.svg',
            'saucony': 'https://upload.wikimedia.org/wikipedia/commons/7/7c/Saucony_logo.svg',
            'skechers': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Skechers_logo.svg',
            'newton': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Newton_Running_logo.svg',
            'on running': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/On_Running_logo.svg',
            'hoka': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Hoka_logo.svg',
            'salomon': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Salomon_logo.svg',
            'merrell': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Merrell_logo.svg',

            // Luxury
            'gucci': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Gucci_logo.svg',
            'louis vuitton': 'https://upload.wikimedia.org/wikipedia/commons/9/9f/Louis_Vuitton_logo.svg',
            'prada': 'https://upload.wikimedia.org/wikipedia/commons/3/3e/Prada_logo.svg',
            'versace': 'https://upload.wikimedia.org/wikipedia/commons/8/89/Versace_logo.svg',
            'dior': 'https://upload.wikimedia.org/wikipedia/commons/7/7f/Christian_Dior_logo.svg',
            'chanel': 'https://upload.wikimedia.org/wikipedia/commons/7/7a/Chanel_logo.svg',
            'hermes': 'https://upload.wikimedia.org/wikipedia/commons/4/4c/Herm%C3%A8s_logo.svg',
            'burberry': 'https://upload.wikimedia.org/wikipedia/commons/8/8d/Burberry_logo.svg',
            'fendi': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Fendi_logo.svg',
            'balenciaga': 'https://upload.wikimedia.org/wikipedia/commons/4/4b/Balenciaga_logo.svg',
            'givenchy': 'https://upload.wikimedia.org/wikipedia/commons/2/2f/Givenchy_logo.svg',
            'yves saint laurent': 'https://upload.wikimedia.org/wikipedia/commons/3/3c/Yves_Saint_Laurent_logo.svg',
            'bottega veneta': 'https://upload.wikimedia.org/wikipedia/commons/5/5a/Bottega_Veneta_logo.svg',
            'valentino': 'https://upload.wikimedia.org/wikipedia/commons/9/9a/Valentino_logo.svg',
            'dolce & gabbana': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Dolce_%26_Gabbana_logo.svg',
            'alexander mcqueen': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Alexander_McQueen_logo.svg',
            'balmain': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Balmain_logo.svg',
            'celine': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Celine_logo.svg',
            'loewe': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Loewe_logo.svg',
            'marni': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Marni_logo.svg',

            // Streetwear & Fashion
            'supreme': 'https://upload.wikimedia.org/wikipedia/commons/2/28/Supreme_logo.svg',
            'off-white': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Off-White_logo.svg',
            'palace': 'https://upload.wikimedia.org/wikipedia/commons/8/8d/Palace_Skateboards_logo.svg',
            'stussy': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Stussy_logo.svg',
            'bape': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/BAPE_logo.svg',
            'kith': 'https://upload.wikimedia.org/wikipedia/commons/4/4c/Kith_logo.svg',
            'fear of god': 'https://upload.wikimedia.org/wikipedia/commons/8/8d/Fear_of_God_logo.svg',
            'yeezy': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Yeezy_logo.svg',
            'stone island': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Stone_Island_logo.svg',
            'moncler': 'https://upload.wikimedia.org/wikipedia/commons/4/4c/Moncler_logo.svg',
            'acne studios': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Acne_Studios_logo.svg',
            'alyx': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Alyx_logo.svg',
            'ambush': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Ambush_logo.svg',
            'heron preston': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Heron_Preston_logo.svg',
            'noah': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Noah_logo.svg',

            // Fast Fashion
            'zara': 'https://upload.wikimedia.org/wikipedia/commons/5/53/Zara_logo.svg',
            'h&m': 'https://upload.wikimedia.org/wikipedia/commons/5/53/H%26M-Logo.svg',
            'uniqlo': 'https://upload.wikimedia.org/wikipedia/commons/9/92/UNIQLO_logo.svg',
            'forever 21': 'https://upload.wikimedia.org/wikipedia/commons/8/8d/Forever_21_logo.svg',
            'topshop': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Topshop_logo.svg',
            'asos': 'https://upload.wikimedia.org/wikipedia/commons/0/0c/ASOS_logo.svg',
            'boohoo': 'https://upload.wikimedia.org/wikipedia/commons/4/4c/Boohoo_logo.svg',
            'missguided': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Missguided_logo.svg',
            'pretty little thing': 'https://upload.wikimedia.org/wikipedia/commons/5/5a/PrettyLittleThing_logo.svg',
            'nasty gal': 'https://upload.wikimedia.org/wikipedia/commons/8/8d/Nasty_Gal_logo.svg',
            'fashion nova': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Fashion_Nova_logo.svg',
            'revolve': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Revolve_logo.svg',
            'nordstrom': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Nordstrom_logo.svg',
            'urban outfitters': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Urban_Outfitters_logo.svg',
            'anthropologie': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Anthropologie_logo.svg',

            // Denim & Casual
            'levi\'s': 'https://upload.wikimedia.org/wikipedia/commons/2/21/Levi%27s_logo.svg',
            'gap': 'https://upload.wikimedia.org/wikipedia/commons/7/7a/Gap_logo.svg',
            'calvin klein': 'https://upload.wikimedia.org/wikipedia/commons/5/5c/Calvin_Klein_logo.svg',
            'tommy hilfiger': 'https://upload.wikimedia.org/wikipedia/commons/5/5c/Tommy_Hilfiger_Logo.svg',
            'ralph lauren': 'https://upload.wikimedia.org/wikipedia/commons/d/d6/Ralph_Lauren_logo.svg',
            'wrangler': 'https://upload.wikimedia.org/wikipedia/commons/8/8d/Wrangler_logo.svg',
            'lee': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Lee_logo.svg',
            'diesel': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Diesel_logo.svg',
            'guess': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Guess_logo.svg',
            'hollister': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Hollister_logo.svg',
            'abercrombie & fitch': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Abercrombie_%26_Fitch_logo.svg',
            'american eagle': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/American_Eagle_logo.svg',
            'express': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Express_logo.svg',
            'banana republic': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Banana_Republic_logo.svg',
            'j.crew': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/J_Crew_logo.svg',

            // Accessories
            'ray-ban': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Ray-Ban_logo.svg',
            'oakley': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Oakley_logo.svg',
            'swatch': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Swatch_logo.svg',
            'fossil': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Fossil_logo.svg',
            'michael kors': 'https://upload.wikimedia.org/wikipedia/commons/5/5c/Michael_Kors_logo.svg',
            'kate spade': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Kate_Spade_logo.svg',
            'coach': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Coach_logo.svg',
            'tory burch': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Tory_Burch_logo.svg',
            'longchamp': 'https://upload.wikimedia.org/wikipedia/commons/5/5c/Longchamp_logo.svg',
            'furla': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Furla_logo.svg',

            // Watches
            'rolex': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Rolex_logo.svg',
            'omega': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Omega_logo.svg',
            'tag heuer': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Tag_Heuer_logo.svg',
            'cartier': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Cartier_logo.svg',
            'breitling': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Breitling_logo.svg',
            'tissot': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Tissot_logo.svg',
            'seiko': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Seiko_logo.svg',
            'citizen': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Citizen_logo.svg',
            'casio': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Casio_logo.svg',
            'timex': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Timex_logo.svg',

            // Jewelry
            'tiffany & co': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Tiffany_%26_Co_logo.svg',
            'pandora': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Pandora_logo.svg',
            'swarovski': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Swarovski_logo.svg',
            'bulgari': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Bulgari_logo.svg',
            'van cleef & arpels': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Van_Cleef_%26_Arpels_logo.svg',
            'harry winston': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Harry_Winston_logo.svg',
            'graff': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Graff_logo.svg',
            'chopard': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Chopard_logo.svg',
            'piaget': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Piaget_logo.svg',
            'david yurman': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/David_Yurman_logo.svg',

            // Footwear
            'dr. martens': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Dr_Martens_logo.svg',
            'timberland': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Timberland_logo.svg',
            'clarks': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Clarks_logo.svg',
            'ecco': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/ECCO_logo.svg',
            'birkenstock': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Birkenstock_logo.svg',
            'ugg': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/UGG_logo.svg',
            'crocs': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/Crocs_logo.svg',
            'sperry': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Sperry_logo.svg',
            'toms': 'https://upload.wikimedia.org/wikipedia/commons/2/2a/TOMS_logo.svg',
            'steve madden': 'https://upload.wikimedia.org/wikipedia/commons/7/7d/Steve_Madden_logo.svg'
        };

        // Function to detect brand from class name
        function detectBrand(className) {
            const lowerClassName = className.toLowerCase();
            for (const [brand, _] of Object.entries(brandLogos)) {
                if (lowerClassName.includes(brand)) {
                    return brand;
                }
            }
            return null;
        }

        // Function to get product info
        function getProductInfo(className) {
            const lowerClassName = className.toLowerCase();
            for (const [key, info] of Object.entries(productDatabase)) {
                if (lowerClassName.includes(key)) {
                    return info;
                }
            }
            return null;
        }

        // Debug logging function
        function debugLog(message) {
            console.log(message);
            const debugInfo = document.getElementById('debug-info');
            debugInfo.textContent = message;
        }

        // Error handling function
        function showError(message) {
            console.error(message);
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        // Check if required libraries are loaded
        function checkDependencies() {
            const dependencies = {
                'React': typeof React !== 'undefined',
                'ReactDOM': typeof ReactDOM !== 'undefined',
                'TensorFlow.js': typeof tf !== 'undefined',
                'COCO-SSD': typeof cocoSsd !== 'undefined',
                'Pose Detection': typeof poseDetection !== 'undefined'
            };

            const missing = Object.entries(dependencies)
                .filter(([_, loaded]) => !loaded)
                .map(([name]) => name);

            if (missing.length > 0) {
                throw new Error(`Missing dependencies: ${missing.join(', ')}`);
            }

            debugLog('All dependencies loaded successfully');
        }

        // Initialize webcam
        async function initWebcam(facingMode = 'user') {
            try {
                debugLog(`Requesting camera access (${facingMode})...`);
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: facingMode,
                        width: { ideal: 1920 },
                        height: { ideal: 1080 }
                    } 
                });
                const videoElement = document.getElementById('video-feed');
                
                // Stop any existing stream
                if (videoElement.srcObject) {
                    videoElement.srcObject.getTracks().forEach(track => track.stop());
                }
                
                videoElement.srcObject = stream;
                
                debugLog('Camera access granted');
                
                // Wait for video to be ready
                return new Promise((resolve) => {
                    videoElement.onloadedmetadata = () => {
                        debugLog('Video stream ready');
                        resolve(videoElement);
                    };
                });
            } catch (err) {
                const errorMsg = 'Error accessing webcam: ' + err.message;
                debugLog(errorMsg);
                showError(errorMsg);
                throw err;
            }
        }

        // App Component
        const App = ({ initialVideoRef }) => {
            const [detections, setDetections] = React.useState([]);
            const [poses, setPoses] = React.useState([]);
            const [isModelLoading, setIsModelLoading] = React.useState(true);
            const [loadingProgress, setLoadingProgress] = React.useState('Initializing...');
            const [showToast, setShowToast] = React.useState(false);
            const [error, setError] = React.useState(null);
            const [isFrontCamera, setIsFrontCamera] = React.useState(true);
            const [videoRef, setVideoRef] = React.useState(initialVideoRef);
            const [isTransitioning, setIsTransitioning] = React.useState(false);
            const modelRef = React.useRef(null);
            const poseModelRef = React.useRef(null);

            // Load models
            React.useEffect(() => {
                const loadModels = async () => {
                    try {
                        setLoadingProgress('Loading TensorFlow.js...');
                        await tf.ready();
                        
                        setLoadingProgress('Loading COCO-SSD model...');
                        const model = await cocoSsd.load({
                            base: 'lite_mobilenet_v2'
                        });
                        modelRef.current = model;

                        setLoadingProgress('Loading MoveNet model...');
                        const poseModel = await poseDetection.createDetector(
                            poseDetection.SupportedModels.MoveNet,
                            {
                                modelType: 'lightning'
                            }
                        );
                        poseModelRef.current = poseModel;

                        setLoadingProgress('Models loaded successfully!');
                        setIsModelLoading(false);
                    } catch (err) {
                        const errorMsg = 'Failed to load models: ' + err.message;
                        debugLog(errorMsg);
                        setError(errorMsg);
                    }
                };
                loadModels();
            }, []);

            // Run detection
            React.useEffect(() => {
                let animationFrameId;
                const detectObjectsAndPose = async () => {
                    if (modelRef.current && poseModelRef.current && videoRef && !isTransitioning) {
                        try {
                            // Run object detection
                            const predictions = await modelRef.current.detect(videoRef);
                            setDetections(predictions);

                            // Run pose detection
                            const poses = await poseModelRef.current.estimatePoses(videoRef);
                            setPoses(poses);
                        } catch (err) {
                            const errorMsg = 'Detection error: ' + err.message;
                            debugLog(errorMsg);
                            setError(errorMsg);
                        }
                    }
                    animationFrameId = requestAnimationFrame(detectObjectsAndPose);
                };

                if (!isModelLoading && !error) {
                    detectObjectsAndPose();
                }

                return () => {
                    if (animationFrameId) {
                        cancelAnimationFrame(animationFrameId);
                    }
                };
            }, [isModelLoading, error, videoRef, isTransitioning]);

            // Handle camera switch
            const handleCameraSwitch = async (facingMode) => {
                try {
                    setIsTransitioning(true);
                    const transitionElement = document.getElementById('camera-transition');
                    transitionElement.classList.add('active');
                    
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    const newVideoRef = await initWebcam(facingMode);
                    setVideoRef(newVideoRef);
                    setIsFrontCamera(facingMode === 'user');
                    
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                    transitionElement.classList.remove('active');
                    setIsTransitioning(false);
                } catch (err) {
                    const errorMsg = 'Failed to switch camera: ' + err.message;
                    debugLog(errorMsg);
                    setError(errorMsg);
                    setIsTransitioning(false);
                }
            };

            const handleShare = () => {
                try {
                    const items = detections
                        .filter(det => ['person', 'backpack', 'handbag', 'suitcase', 'bottle', 'wine glass', 'cup', 'bowl', 'chair', 'couch', 'bed', 'dining table', 'toilet', 'tv', 'laptop', 'mouse', 'remote', 'keyboard', 'cell phone', 'microwave', 'oven', 'toaster', 'sink', 'refrigerator', 'book', 'clock', 'vase', 'scissors', 'teddy bear', 'hair drier', 'toothbrush'].includes(det.class))
                        .map(det => det.class);
                    
                    const text = `Today's Fit: ${items.join(', ')}`;
                    navigator.clipboard.writeText(text);
                    setShowToast(true);
                    setTimeout(() => setShowToast(false), 2000);
                } catch (err) {
                    const errorMsg = 'Share error: ' + err.message;
                    debugLog(errorMsg);
                    setError(errorMsg);
                }
            };

            if (error) {
                return React.createElement('div', { className: 'fixed inset-0 flex items-center justify-center bg-black bg-opacity-50' },
                    React.createElement('div', { className: 'bg-white p-6 rounded-lg shadow-xl max-w-md' },
                        React.createElement('h2', { className: 'text-xl font-bold text-red-600 mb-4' }, 'Error'),
                        React.createElement('p', { className: 'text-gray-700 mb-4' }, error),
                        React.createElement('button', {
                            onClick: () => window.location.reload(),
                            className: 'bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600'
                        }, 'Refresh Page')
                    )
                );
            }

            return React.createElement('div', { className: 'relative w-full h-screen' },
                // Camera Controls
                React.createElement('div', { className: 'camera-controls' },
                    React.createElement('button', {
                        onClick: () => handleCameraSwitch('user'),
                        className: `camera-button ${isFrontCamera ? 'active' : ''}`,
                        title: 'Switch to front camera',
                        disabled: isTransitioning || isFrontCamera
                    }, 'ðŸ“±'),
                    React.createElement('button', {
                        onClick: () => handleCameraSwitch('environment'),
                        className: `camera-button ${!isFrontCamera ? 'active' : ''}`,
                        title: 'Switch to back camera',
                        disabled: isTransitioning || !isFrontCamera
                    }, 'ðŸ“·')
                ),
                // Pose Points and Lines
                poses.map((pose, poseIndex) => 
                    pose.keypoints.map((keypoint, index) => 
                        keypoint.score > 0.3 && React.createElement('div', {
                            key: `pose-${poseIndex}-${index}`,
                            className: 'pose-point',
                            style: {
                                left: `${keypoint.x}px`,
                                top: `${keypoint.y}px`
                            }
                        })
                    )
                ),
                // Detection Labels
                detections.map((detection, index) => {
                    const brand = detectBrand(detection.class);
                    const productInfo = getProductInfo(detection.class);
                    return React.createElement('div', {
                        key: index,
                        className: 'detection-label',
                        style: {
                            left: `${detection.bbox[0]}px`,
                            top: `${detection.bbox[1]}px`,
                            width: `${detection.bbox[2]}px`,
                            height: `${detection.bbox[3]}px`
                        }
                    },
                        React.createElement('div', { className: 'flex flex-col' },
                            React.createElement('div', { className: 'flex items-center gap-2' },
                                brand && React.createElement('img', {
                                    src: brandLogos[brand],
                                    alt: brand,
                                    className: 'brand-logo'
                                }),
                                React.createElement('span', null, detection.class),
                                productInfo && React.createElement('span', {
                                    className: 'price-tag'
                                }, `$${productInfo.price}`)
                            ),
                            productInfo && React.createElement('span', {
                                className: 'text-sm text-gray-300'
                            }, productInfo.description)
                        )
                    );
                }),
                // Share Button
                React.createElement('button', {
                    onClick: handleShare,
                    className: 'fixed bottom-8 left-1/2 transform -translate-x-1/2 bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-full shadow-lg transition-all duration-200'
                }, 'Share My Fit'),
                // Loading Indicator
                isModelLoading && React.createElement('div', {
                    className: 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black bg-opacity-50 text-white px-4 py-2 rounded text-center'
                },
                    React.createElement('div', { className: 'loading-spinner' }),
                    React.createElement('p', { className: 'mt-2' }, loadingProgress)
                ),
                // Toast Message
                showToast && React.createElement('div', {
                    className: 'fixed top-8 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-4 py-2 rounded shadow-lg transition-all duration-200'
                }, 'Outfit copied to clipboard!')
            );
        };

        // Initialize app
        async function initApp() {
            try {
                debugLog('Initializing app...');
                checkDependencies();
                const videoElement = await initWebcam();
                debugLog('Creating React root...');
                const root = ReactDOM.createRoot(document.getElementById('app-root'));
                debugLog('Rendering app...');
                root.render(React.createElement(App, { initialVideoRef: videoElement }));
                debugLog('App initialized successfully');
            } catch (err) {
                const errorMsg = 'Failed to initialize app: ' + err.message;
                debugLog(errorMsg);
                showError(errorMsg);
            }
        }

        // Start the app
        initApp();
    </script>
</body>
</html> 